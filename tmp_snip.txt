@router.post("/hospitals", response_model=HospitalOut, status_code=201)
def create_hospital(payload: HospitalIn, db: Session = Depends(get_db), user=Depends(get_current_user)):
    _ensure_admin(user)

    exists = db.query(Hospital).filter(Hospital.codigo == payload.codigo).first()
    if exists:
        raise HTTPException(status_code=409, detail="CÃ³digo ya existe")

    hosp = Hospital(
        nombre=payload.nombre,
        direccion=payload.direccion,
        ciudad=payload.ciudad,
        telefono=payload.telefono,
        correo=payload.correo,
        codigo=payload.codigo,
        estado="ACTIVO",
    )
    db.add(hosp)
    db.commit()
    db.refresh(hosp)
    return hosp


@router.patch("/hospitals/{hospital_id}", response_model=HospitalOut)
def update_hospital(
    hospital_id: int,
    payload: HospitalUpdateIn,
    db: Session = Depends(get_db),
    user=Depends(get_current_user),
):
    _ensure_admin(user)